<!-- Add AO Entry Modal -->

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas_add" style="width: 1000px !important;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="offcanvas_add_label">Add/Edit AO Entry</h5>
        <button type="button" class="btn-close custom-btn-close border p-1 me-0 d-flex align-items-center justify-content-center rounded-circle" data-bs-dismiss="offcanvas" aria-label="Close">
            <i class="ti ti-x"></i>
        </button>
    </div>
    <div class="offcanvas-body">
        <form action="{% url 'ao_entry_create' %}" method="POST">
            {% csrf_token %}
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">AO Ref No</label>
                    <input type="text" name="ao_ref_no" class="form-control" readonly>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">AO Issued Date</label>
                    <input type="date" name="ao_issued_date" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">MRF</label>
                    <select name="mrf" id="mrf" class="form-control">
                        <option value="">Select MRF</option>
                        {% for mrf in mrf_data %}
                        <option value="{{ mrf.id }}"
                        data-project-code="{{ mrf.project_code }}"
                        data-designation-code="{{ mrf.designation_code }}"
                        data-category="{{ mrf.category }}">
                        {{ mrf.mrf_number }} - {{ mrf.project_code }} - {{ mrf.designation_code }} - {{ mrf.category }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Department</label>
                    <select name="dep" class="form-control">
                        <option value="">Select Department</option>
                        {% for department in dept_data %}
                        <option value="{{ department.base_value }}">{{ department.base_value }} - {{ department.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Project</label>
                    <select name="project" class="form-control" id="project">
                        <option value="">Select Project</option>
                        {% for project in project_data %}
                        <option value="{{ project.prj_code }}">{{ project.prj_code }} - {{ project.prj_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- category -->
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Category</label>
                    <select name="category" class="form-control" id="category">
                        <option value="">Select Category</option>
                        {% for category in staff_category_data %}
                        <option value="{{ category.base_value }}">{{ category.base_value }} - {{ category.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Name as per PP</label>
                    <input type="text" name="name_as_per_pp" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Number</label>
                    <input type="text" name="pp_number" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Expiry Date</label>
                    <input type="date" name="pp_exp_date" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Validity Days</label>
                    <input type="number" name="pp_validity_days" class="form-control" readonly>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Date of Birth</label>
                    <input type="date" name="dob" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Age</label>
                    <input type="number" name="age" class="form-control" readonly>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Telephone</label>
                    <input type="number" step="0.01" name="telephone" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Nationality</label>
                    <select name="nationality" class="form-control">
                        <option value="">Select Nationality</option>
                        {% for nationality in nation_data %}
                        <option value="{{ nationality.base_value }}">{{ nationality.base_value }} - {{ nationality.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Agent</label>
                    <select name="agent" class="form-control">
                        <option value="">Select Agent</option>
                        {% for agent in agent_data %}
                        <option value="{{ agent.base_value }}">{{ agent.base_value }} - {{ agent.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Designation</label>
                    <select name="designation" class="form-control" id="designation">
                        <option value="">Select Designation</option>
                        {% for designation in desig_data %}
                        <option value="{{ designation.base_value }}">{{ designation.base_value }} - {{ designation.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Gender</label>
                    <select name="gender" class="form-control">
                        <option value="">Select Gender</option>
                        {% for gender in gender_data %}
                        <option value="{{ gender.base_value }}">{{ gender.base_value }} - {{ gender.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Interview Date</label>
                    <input type="date" name="interview_date" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Employee Status</label>
                    <select name="employee_status" class="form-control">
                        <option value="">Select Employee Status</option>
                        <option value="Inside">Inside</option>
                        <option value="Outside">Outside</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Grade</label>
                    <select name="grade" class="form-control">
                        <option value="">Select Grade</option>
                        {% for grade in grade_code_data %}
                        <option value="{{ grade.grade_code }}">{{ grade.grade_code }} - {{ grade.grade_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Basic</label>
                    <input type="number" step="0.01" name="basic" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">HRA</label>
                    <input type="number" step="0.01" name="hra" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Transportation Allowance</label>
                    <input type="number" step="0.01" name="transportation_allowance" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Accommodation</label>
                    <input type="number" step="0.01" name="accommodation" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Additional Duty Allowance</label>
                    <input type="number" step="0.01" name="additional_duty_allowance" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Other Allowance</label>
                    <input type="number" step="0.01" name="other_allowance" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Total</label>
                    <input type="number" step="0.01" name="total" class="form-control" readonly>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">In Words</label>
                    <input type="text" name="in_words" class="form-control" readonly>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">AO Acceptance</label>
                    <select name="ao_acceptance" class="form-control">
                        <option value="">Select AO Acceptance</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Acceptance Date</label>
                    <input type="date" name="acceptance_date" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Document Status</label>
                    <input type="text" name="document_status" class="form-control">
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-light me-2" data-bs-dismiss="offcanvas">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Edit AO Entry Modal -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas_edit" style="width: 1000px !important;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="offcanvas_edit_label">Edit AO Entry</h5>
        <button type="button" class="btn-close custom-btn-close border p-1 me-0 d-flex align-items-center justify-content-center rounded-circle" data-bs-dismiss="offcanvas" aria-label="Close">
            <i class="ti ti-x"></i>
        </button>
    </div>
    <div class="offcanvas-body">
        <form method="POST" action="{% url 'ao_entry_update' %}">
            {% csrf_token %}
            <input type="hidden" name="ao_entry_id" id="ao_entry_id">
            <div class="col-md-4 mb-3"> 
                <label class="col-form-label">AO Ref No</label>
                <input type="text" name="ao_ref_no" id="edit_ao_ref_no" class="form-control" readonly>
            </div>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">AO Issued Date</label>
                    <input type="date" name="ao_issued_date" id="edit_ao_issued_date" class="form-control" required>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">MRF</label>
                    <select name="mrf" id="edit_mrf" class="form-control">
                        <option value="">Select MRF</option>
                        {% for mrf in mrf_data %}
                        <option value="{{ mrf.id }}"
                        data-project-code="{{ mrf.project_code }}"
                        data-designation-code="{{ mrf.designation_code }}"
                        data-category="{{ mrf.category }}">
                        {{ mrf.mrf_number }} - {{ mrf.project_code }} - {{ mrf.designation_code }} - {{ mrf.category }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Department</label>
                    <select name="dep" id="edit_dep" class="form-control">
                        <option value="">Select Department</option>
                        {% for department in dept_data %}
                        <option value="{{ department.base_value }}">{{ department.base_value }} - {{ department.base_description }}</option>
                        {% endfor %}    
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Project</label>
                    <select name="project" id="edit_project" class="form-control">
                        <option value="">Select Project</option>    
                        {% for project in project_data %}
                        <option value="{{ project.prj_code }}">{{ project.prj_code }} - {{ project.prj_name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <!-- category -->
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Category</label>
                    <select name="category" id="edit_category" class="form-control">
                        <option value="">Select Category</option>
                        {% for category in staff_category_data %}
                        <option value="{{ category.base_value }}">{{ category.base_value }} - {{ category.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Name as per PP</label>
                    <input type="text" name="name_as_per_pp" id="edit_name_as_per_pp" class="form-control">      
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Number</label>
                    <input type="text" name="pp_number" id="edit_pp_number" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Expiry Date</label>
                    <input type="date" name="pp_exp_date" id="edit_pp_exp_date" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Validity Days</label>
                    <input type="number" name="pp_validity_days" id="edit_pp_validity_days" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Date of Birth</label>
                    <input type="date" name="dob" id="edit_dob" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Age</label>
                    <input type="number" name="age" id="edit_age" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Telephone</label>
                    <input type="number" step="0.01" name="telephone" id="edit_telephone" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Nationality</label>
                    <select name="nationality" id="edit_nationality" class="form-control">
                        <option value="">Select Nationality</option>
                        {% for nationality in nation_data %}
                        <option value="{{ nationality.base_value }}">{{ nationality.base_value }} - {{ nationality.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Agent</label>
                    <select name="agent" id="edit_agent" class="form-control">
                        <option value="">Select Agent</option>
                        {% for agent in agent_data %}
                        <option value="{{ agent.base_value }}">{{ agent.base_value }} - {{ agent.base_description }}</option>   
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Designation</label>
                    <select name="designation" id="edit_designation" class="form-control">
                        <option value="">Select Designation</option>
                        {% for designation in desig_data %}
                        <option value="{{ designation.base_value }}">{{ designation.base_value }} - {{ designation.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Gender</label>
                    <select name="gender" id="edit_gender" class="form-control">
                        <option value="">Select Gender</option>
                        {% for gender in gender_data %}
                        <option value="{{ gender.base_value }}">{{ gender.base_value }} - {{ gender.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Employee Status</label>
                    <select name="employee_status" id="edit_employee_status" class="form-control">
                        <option value="">Select Employee Status</option>
                        <option value="Inside">Inside</option>
                        <option value="Outside">Outside</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Interview Date</label>
                    <input type="date" name="interview_date" id="edit_interview_date" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Grade</label>
                    <select name="grade" id="edit_grade" class="form-control">
                        <option value="">Select Grade</option>
                        {% for grade in grade_code_data %}
                        <option value="{{ grade.grade_code }}">{{ grade.grade_code }} - {{ grade.grade_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Basic</label>
                    <input type="number" step="0.01" name="basic" id="edit_basic" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">HRA</label>   
                    <input type="number" step="0.01" name="hra" id="edit_hra" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Transportation Allowance</label>
                    <input type="number" step="0.01" name="transportation_allowance" id="edit_transportation_allowance" class="form-control">
                </div>  
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Accommodation</label>
                    <input type="number" step="0.01" name="accommodation" id="edit_accommodation" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Additional Duty Allowance</label>
                    <input type="number" step="0.01" name="additional_duty_allowance" id="edit_additional_duty_allowance" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Other Allowance</label>
                    <input type="number" step="0.01" name="other_allowance" id="edit_other_allowance" class="form-control">
                </div>  
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Total</label>
                    <input type="number" step="0.01" name="total" id="edit_total" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">In Words</label>
                    <input type="text" name="in_words" id="edit_in_words" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">AO Acceptance</label>
                    <select name="ao_acceptance" id="edit_ao_acceptance" class="form-control">
                        <option value="">Select AO Acceptance</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Acceptance Date</label>
                    <input type="date" name="acceptance_date" id="edit_acceptance_date" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Document Status</label>
                    <input type="text" name="document_status" id="edit_document_status" class="form-control">
                </div>
            </div>
            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-light me-2" data-bs-dismiss="offcanvas">Cancel</button>
                <button type="submit" class="btn btn-primary">Update</button>
            </div>
        </form>
    </div>
</div>

<script>
    $(document).ready(function() {
        $('#mrf').change(function() {
            const selectedOption = $(this).find('option:selected');
            const projectCode = selectedOption.data('project-code');
            const designationCode = selectedOption.data('designation-code');
            const category = selectedOption.data('category');
            $('#project').val(projectCode);
            $('#designation').val(designationCode);
            $('#category').val(category);
        });


        $('#edit_mrf').change(function() {
            const selectedOption = $(this).find('option:selected');
            const projectCode = selectedOption.data('project-code');
            const designationCode = selectedOption.data('designation-code');
            const category = selectedOption.data('category');
            $('#edit_project').val(projectCode);
            $('#edit_designation').val(designationCode);
            $('#edit_category').val(category);
        });
    });

    // Form validation functions
    function validateForm(formId) {
        const form = document.getElementById(formId);
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;

        // Check required fields
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });

        // Validate passport expiry date
        const ppExpDate = form.querySelector('input[name="pp_exp_date"]');
        if (ppExpDate && ppExpDate.value) {
            const expiryDate = new Date(ppExpDate.value);
            const sixMonthsLater = new Date();
            sixMonthsLater.setMonth(sixMonthsLater.getMonth() + 6);
            
            if (expiryDate < sixMonthsLater) {
                alert('Warning: Passport expiry date must be at least 6 months from today!');
                ppExpDate.classList.add('is-invalid');
                isValid = false;
            }
        }

        // Validate date of birth
        const dob = form.querySelector('input[name="dob"]');
        if (dob && dob.value) {
            const birthDate = new Date(dob.value);
            const today = new Date();
            const age = calculateAge(dob.value);
            
            if (birthDate > today) {
                alert('Error: Date of birth cannot be in the future!');
                dob.classList.add('is-invalid');
                isValid = false;
            }
            
            if (age < 18) {
                alert('Warning: Age must be at least 18 years!');
                dob.classList.add('is-invalid');
                isValid = false;
            }
        }

        // Validate numeric fields
        const numericFields = form.querySelectorAll('input[type="number"]');
        numericFields.forEach(field => {
            if (field.value && parseFloat(field.value) < 0) {
                field.classList.add('is-invalid');
                field.value = '0';
                isValid = false;
            }
        });

        return isValid;
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Clear validation on input
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                this.classList.remove('is-invalid');
            });
        });

        // Age calculation and validation
        const dobFields = document.querySelectorAll('input[name="dob"]');
        dobFields.forEach(dobField => {
            dobField.addEventListener('change', function() {
                if (!this.value) return;
                
                const ageField = this.closest('form').querySelector('input[name="age"]');
                if (ageField) {
                    const age = calculateAge(this.value);
                    ageField.value = age;
                    
                    const birthDate = new Date(this.value);
                    const today = new Date();
                    
                    if (birthDate > today) {
                        alert('Error: Date of birth cannot be in the future!');
                        this.classList.add('is-invalid');
                        this.value = '';
                        ageField.value = '';
                    } else if (age < 18) {
                        alert('Warning: Age must be at least 18 years!');
                        this.classList.add('is-invalid');
                        this.value = '';
                        ageField.value = '';
                    }
                }
            });
        });

        // Passport expiry validation and validity days calculation
        const ppExpDateFields = document.querySelectorAll('input[name="pp_exp_date"]');
        ppExpDateFields.forEach(ppExpDateField => {
            ppExpDateField.addEventListener('change', function() {
                if (!this.value) return;
                
                const validityDaysField = this.closest('form').querySelector('input[name="pp_validity_days"]');
                if (validityDaysField) {
                    const today = new Date();
                    const expiryDate = new Date(this.value);
                    const sixMonthsLater = new Date();
                    sixMonthsLater.setMonth(sixMonthsLater.getMonth() + 6);
                    
                    if (expiryDate < sixMonthsLater) {
                        alert('Warning: Passport expiry date must be at least 6 months from today!');
                        this.classList.add('is-invalid');
                        this.value = '';
                        validityDaysField.value = '';
                    } else {
                        const days = calculateDaysBetween(today, expiryDate);
                        validityDaysField.value = days;
                    }
                }
            });
        });

        // Calculate total and update in words for both forms
        const amountFields = [
            'basic',
            'hra',
            'transportation_allowance',
            'accommodation',
            'additional_duty_allowance',
            'other_allowance'
        ];

        // Add event listeners to both forms
        ['offcanvas_add', 'offcanvas_edit'].forEach(formId => {
            const form = document.getElementById(formId);
            if (form) {
                amountFields.forEach(fieldName => {
                    const field = form.querySelector(`input[name="${fieldName}"]`);
                    if (field) {
                        field.addEventListener('input', function() {
                            // Prevent negative values
                            if (this.value < 0) {
                                this.value = '0';
                            }
                            calculateTotalAndWords(formId);
                        });
                    }
                });
            }
        });
    });

    // Helper functions
    function calculateAge(dateOfBirth) {
        const today = new Date();
        const birthDate = new Date(dateOfBirth);
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
            age--;
        }
        return age;
    }

    function calculateDaysBetween(date1, date2) {
        const oneDay = 24 * 60 * 60 * 1000;
        return Math.round(Math.abs((date1 - date2) / oneDay));
    }

    function calculateTotalAndWords(formId) {
        const form = document.getElementById(formId);
        const amountFields = [
            'basic',
            'hra',
            'transportation_allowance',
            'accommodation',
            'additional_duty_allowance',
            'other_allowance'
        ];

        let total = 0;
        amountFields.forEach(fieldName => {
            const field = form.querySelector(`input[name="${fieldName}"]`);
            if (field && field.value) {
                total += parseFloat(field.value) || 0;
            }
        });

        const totalField = form.querySelector('input[name="total"]');
        if (totalField) {
            totalField.value = total.toFixed(2);
            
            const inWordsField = form.querySelector('input[name="in_words"]');
            if (inWordsField) {
                inWordsField.value = numberToWords(total);
            }
        }
    }

    function numberToWords(num) {
        const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine'];
        const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];
        const teens = ['Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];

        function convertLessThanThousand(n) {
            if (n === 0) return '';
            
            let words = '';
            
            if (n >= 100) {
                words += ones[Math.floor(n / 100)] + ' Hundred ';
                n %= 100;
            }
            
            if (n >= 10) {
                if (n < 20) {
                    words += teens[n - 10];
                    return words;
                } else {
                    words += tens[Math.floor(n / 10)];
                    if (n % 10 > 0) {
                        words += ' ' + ones[n % 10];
                    }
                }
            } else if (n > 0) {
                words += ones[n];
            }
            
            return words;
        }

        if (num === 0) return 'Zero';

        let words = '';
        const decimalPart = Math.round((num % 1) * 100);
        let wholePart = Math.floor(num);

        if (wholePart > 0) {
            if (wholePart >= 1000000000) {
                const billions = Math.floor(wholePart / 1000000000);
                words += convertLessThanThousand(billions) + ' Billion ';
                wholePart %= 1000000000;
            }
            
            if (wholePart >= 1000000) {
                const millions = Math.floor(wholePart / 1000000);
                words += convertLessThanThousand(millions) + ' Million ';
                wholePart %= 1000000;
            }
            
            if (wholePart >= 1000) {
                const thousands = Math.floor(wholePart / 1000);
                words += convertLessThanThousand(thousands) + ' Thousand ';
                wholePart %= 1000;
            }
            
            if (wholePart > 0) {
                words += convertLessThanThousand(wholePart);
            }
        }

        if (decimalPart > 0) {
            if (words) words += ' and ';
            words += convertLessThanThousand(decimalPart) + ' Cents';
        }

        return words.trim();
    }
</script>
