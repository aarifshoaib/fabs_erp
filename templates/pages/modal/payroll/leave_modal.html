{% load static %}

<!-- Add New Leave Offcanvas Modal -->
<div class="offcanvas offcanvas-end offcanvas-large" tabindex="-1" id="offcanvas_add_leave"
    aria-labelledby="offcanvasLabel">
    <div class="offcanvas-header border-bottom">
        <h4 class="offcanvas-title" id="offcanvasLabel">Add New LeaveMaster</h4>
        <button type="button"
            class="btn-close custom-btn-close border p-1 me-0 d-flex align-items-center justify-content-center rounded-circle"
            data-bs-dismiss="offcanvas" aria-label="Close">
            <i class="ti ti-x"></i>
        </button>
    </div>
    <div class="offcanvas-body">
        <form method="POST" action="{% url 'create_leavemaster' %}">
            {% csrf_token %}
            <div>
                <div class="row">
                    <!-- Leave Code -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="col-form-label">Leave Code <span class="text-danger">*</span></label>
                            <input type="text" name="leave_code" class="form-control" autocomplete="off" required>
                        </div>
                    </div>

                    <!-- Leave Description -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="col-form-label">Leave Description <span class="text-danger">*</span></label>
                            <textarea name="leave_description" class="form-control" rows="2" required></textarea>
                        </div>
                    </div>

                    <!-- Work Month -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="col-form-label">Work Month <span class="text-danger">*</span></label>
                            <input type="number" name="work_month" class="form-control" min="0" autocomplete="off"
                                required>
                        </div>
                    </div>

                    <!-- Eligible Days -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="col-form-label">Eligible Days <span class="text-danger">*</span></label>
                            <input type="number" name="eligible_days" class="form-control" min="0" required>
                        </div>
                    </div>

                    <!-- Day Type -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="eligible_day_type" class="col-form-label">Day Type <span
                                    class="text-danger">*</span></label>
                            <select id="eligible_day_type" name="eligible_day_type" class="form-control" required>
                                <option value="">Select</option>
                                <option value="Calendar">Calendar Days</option>
                                <option value="Working">Working Days</option>
                            </select>
                        </div>
                    </div>

                    <!-- Payment Type -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="payment_type" class="col-form-label">Payment Type <span
                                    class="text-danger">*</span></label>
                            <select id="payment_type" name="payment_type" class="form-control" required>
                                <option value="">Select</option>
                                <option value="Paid">Paid Leave</option>
                                <option value="Unpaid">Unpaid Leave</option>
                                <option value="Half Paid">Half Paid Leave</option>
                            </select>
                        </div>
                    </div>

                    <!-- Frequency -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="frequency" class="col-form-label">Frequency <span
                                    class="text-danger">*</span></label>
                            <select id="frequency" name="frequency" class="form-control" required>
                                <option value="">Select</option>
                                <option value="Monthly">Monthly</option>
                                <option value="Yearly">Yearly</option>
                                <option value="One-time">One-time</option>
                            </select>
                        </div>
                    </div>

                    <!-- Gender -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="gender" class="col-form-label">Gender <span class="text-danger">*</span></label>
                            <select id="gender" name="gender" class="form-control" required>
                                <option value="">Select</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="All">All Genders</option>
                            </select>
                        </div>
                    </div>

                    <!-- Grade -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="grade" class="col-form-label">Grade (Optional)</label>
                            <input type="text" id="grade" name="grade" class="form-control">
                        </div>
                    </div>

                    <!-- Carry Forward -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="carry_forward" class="col-form-label">Carry Forward</label>
                            <input type="checkbox" id="carry_forward" name="carry_forward" class="form-check-input">
                        </div>
                        <!-- Carry Forward Days Input -->
                        <div class="mb-3" id="carry_forward_days_input" style="display: none;">
                            <label for="carry_forward_days" class="col-form-label">Carry Forward Days</label>
                            <input type="number" id="carry_forward_days" name="carry_forward_days" class="form-control"
                                min="0">
                        </div>
                    </div>

                    <!-- Encashment -->
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="encashment" class="col-form-label">Encashment</label>
                            <input type="checkbox" id="encashment" name="encashment" class="form-check-input">
                        </div>
                        <!-- Encashment Days Input -->
                        <div class="mb-3" id="encashment_days_input" style="display: none;">
                            <label for="encashment_days" class="col-form-label">Encashment Days</label>
                            <input type="number" id="encashment_days" name="encashment_days" class="form-control"
                                min="0">
                        </div>
                    </div>
                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Leave</button>
                    </div>
                </div>
        </form>
    </div>


</div>
</div>
</div>
<!-- /Add New Leave Modal -->

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="delete_task" tabindex="-1" aria-labelledby="deleteTaskLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body">
                <div class="text-center">
                    <div class="avatar avatar-xl bg-danger-light rounded-circle mb-3">
                        <i class="ti ti-trash-x fs-36 text-danger"></i>
                    </div>
                    <h4 class="mb-2">Remove Record?</h4>
                    <p class="mb-0">Are you sure you want to remove the selected record?</p>
                    <div class="d-flex align-items-center justify-content-center mt-4">
                        <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                        <form method="POST" action="" id="deleteForm">
                            {% csrf_token %}
                            <button type="button" class="btn btn-danger" id="confirmDelete">Yes, Delete it</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle Carry Forward Days Input
    document.getElementById('carry_forward').addEventListener('change', function () {
        const carryForwardInput = document.getElementById('carry_forward_days_input');
        carryForwardInput.style.display = this.checked ? 'block' : 'none';
    });

    // Toggle Encashment Days Input
    document.getElementById('encashment').addEventListener('change', function () {
        const encashmentInput = document.getElementById('encashment_days_input');
        encashmentInput.style.display = this.checked ? 'block' : 'none';
    });

    let deleteId = null;

    // Capture the record ID when the delete button is clicked
    document.querySelectorAll('[data-bs-target="#delete_task"]').forEach(button => {
        button.addEventListener('click', function () {
            deleteId = this.getAttribute('data-id'); // Get the record ID
        });
    });

    // Handle the delete confirmation
    document.getElementById('confirmDelete').addEventListener('click', function () {
        if (deleteId) {
            fetch(`/leavemaster/delete/${deleteId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}', // Include CSRF token
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (response.ok) {
                    // Close the modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('delete_task'));
                    modal.hide();

                    // Remove the deleted record from the table
                    document.querySelector(`[data-id="${deleteId}"]`).closest('tr').remove();
                } else {
                    alert('Failed to delete the record.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred.');
            });
        }
    });
</script>