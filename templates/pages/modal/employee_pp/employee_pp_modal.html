<!-- Add Employee Passport Details Offcanvas -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas_add" style="width: 1000px !important;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="offcanvas_add_employee_pp_label">Add Employee PLVP Details</h5>
        <button type="button" class="btn-close custom-btn-close border p-1 me-0 d-flex align-items-center justify-content-center rounded-circle" data-bs-dismiss="offcanvas" aria-label="Close">
            <i class="ti ti-x"></i>
        </button>
    </div>
    <div class="offcanvas-body">
        <form id="addEmployeePPForm" action="{% url 'employee_pp_create' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Basic Information Section -->
            <div class="mb-4">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Employee Code</label>
                    <select name="emp_code" id="add_emp_code" class="form-control select2">
                        <option value="">Select Employee Code</option>
                        {% for employee in employee_data %}
                        <option value="{{ employee.emp_code }}">{{ employee.emp_code }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Passport Number</label>
                    <input type="text" name="pp_number" id="add_pp_number" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Name</label>
                    <input type="text" name="name" id="add_name" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">In/Outside</label>
                    <select name="in_outside" id="add_in_outside" class="form-control">
                        <option value="">Select</option>
                        <option value="inside">Inside</option>
                        <option value="outside">Outside</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Status</label>
                    <select name="status" id="add_status" class="form-control">
                        <option value="">Select</option>
                        {% for status in status_data %}
                        <option value="{{ status.base_value }}">{{ status.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Sub Status</label>
                    <input type="text" name="sub_status" id="add_sub_status" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Work Location</label>
                    <input type="text" name="work_location" id="add_work_location" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Date of Joining</label>
                    <input type="date" name="doj" id="add_doj" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Gender</label>
                    <select name="gender" id="add_gender" class="form-control">
                        <option value="">Select</option>
                        {% for gender in gender_data %}
                        <option value="{{ gender.base_value }}">{{ gender.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Designation</label>
                    <select name="designation" id="add_designation" class="form-control">
                        <option value="">Select</option>
                        {% for designation in desig_data %}
                        <option value="{{ designation.base_value }}">{{ designation.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Nationality</label>
                    <select name="nationality" id="add_nationality" class="form-control">
                        <option value="">Select</option>
                        {% for nationality in nation_data %}
                        <option value="{{ nationality.base_value }}">{{ nationality.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Control</label>
                    <select name="pp_control" id="add_pp_control" class="form-control">
                        <option value="">Select</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Date of Landing</label>
                    <input type="date" name="date_of_landing" id="add_date_of_landing" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">No of Days</label>
                    <input type="number" name="no_of_days" id="add_no_of_days" class="form-control" readonly>
                </div>
                                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Fine Amount</label>
                    <input type="number" step="0.01" name="fine_amount" id="add_fine_amount" class="form-control">
                </div>
                            </div>
            </div>

            <!-- Tawjeeh Accordion -->
            <div class="accordion mb-3" id="accordionTawjeeh">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingTawjeeh">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTawjeeh" aria-expanded="false" aria-controls="collapseTawjeeh">
                            <i class="ti ti-book me-2"></i> Tawjeeh
                        </button>
                    </h2>
                    <div id="collapseTawjeeh" class="accordion-collapse collapse" aria-labelledby="headingTawjeeh" data-bs-parent="#accordionTawjeeh">
                        <div class="accordion-body">
                                                         <div class="row">
                                 <div class="col-md-6 mb-3">
                     <label class="col-form-label">Tawjeeh Type</label>
                     <select name="tawjeeh_class" id="add_tawjeeh_class" class="form-control">
                         <option value="">Select</option>
                         {% for tawjeeh_class_status in tawjeeh_class_status_data %}
                         <option value="{{ tawjeeh_class_status.base_value }}">{{ tawjeeh_class_status.base_description }}</option>
                         {% endfor %}
                     </select>
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">Tawjeeh Date</label>
                                     <input type="date" name="tawjeeh_date" id="add_tawjeeh_date" class="form-control">
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ILOE Accordion -->
            <div class="accordion mb-3" id="accordionILOE">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingILOE">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseILOE" aria-expanded="false" aria-controls="collapseILOE">
                            <i class="ti ti-file-check me-2"></i> ILOE
                        </button>
                    </h2>
                    <div id="collapseILOE" class="accordion-collapse collapse" aria-labelledby="headingILOE" data-bs-parent="#accordionILOE">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                    <label class="col-form-label">ILOE Status</label>
                    <select name="iloe_status" id="add_iloe_status" class="form-control">
                        <option value="">Select</option>
                        {% for ioe_status in ioe_status_data %}
                        <option value="{{ ioe_status.base_value }}">{{ ioe_status.base_description }}</option>
                        {% endfor %}
                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Number</label>
                                    <input type="text" name="iloe_number" id="add_iloe_number" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Inception Date</label>
                                    <input type="date" name="iloe_inception_date" id="add_iloe_inception_date" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Expiry Date</label>
                                    <input type="date" name="iloe_expiry_date" id="add_iloe_expiry_date" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Date</label>
                                    <input type="date" name="iloe_date" id="add_iloe_date" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Accordion -->
            <div class="accordion mb-3" id="accordionMedical">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingMedical">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMedical" aria-expanded="false" aria-controls="collapseMedical">
                            <i class="ti ti-stethoscope me-2"></i> Medical
                        </button>
                    </h2>
                    <div id="collapseMedical" class="accordion-collapse collapse" aria-labelledby="headingMedical" data-bs-parent="#accordionMedical">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Medical Status</label>
                    <select name="medical" id="add_medical" class="form-control">
                        <option value="">Select</option>
                        {% for medical_status in medical_status_data %}
                        <option value="{{ medical_status.base_value }}">{{ medical_status.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                                <div class="col-md-6 mb-3">
                    <label class="col-form-label">Medical Result Date</label>
                    <input type="date" name="medical_result_date" id="add_medical_result_date" class="form-control">
                </div>
                                <div class="col-md-6 mb-3">
                    <label class="col-form-label">Remedical Result Date</label>
                    <input type="date" name="remedical_result_date" id="add_remedical_result_date" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Insurance Accordion -->
            <div class="accordion mb-3" id="accordionHealthInsurance">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingHealthInsurance">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHealthInsurance" aria-expanded="false" aria-controls="collapseHealthInsurance">
                            <i class="ti ti-shield-check me-2"></i> Health Insurance
                        </button>
                    </h2>
                    <div id="collapseHealthInsurance" class="accordion-collapse collapse" aria-labelledby="headingHealthInsurance" data-bs-parent="#accordionHealthInsurance">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Insurance Status</label>
                                    <select name="insurance_status" id="add_insurance_status" class="form-control">
                                        <option value="">Select</option>
                                        <option value="Active">Active</option>
                                        <option value="Inactive">Inactive</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Expired">Expired</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Card Number</label>
                                    <input type="text" name="insurance_card_number" id="add_insurance_card_number" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Expiry Date</label>
                                    <input type="date" name="insurance_expiry_date" id="add_insurance_expiry_date" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EID Accordion -->
            <div class="accordion mb-3" id="accordionEID">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEID">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEID" aria-expanded="false" aria-controls="collapseEID">
                            <i class="ti ti-id me-2"></i> EID
                        </button>
                    </h2>
                    <div id="collapseEID" class="accordion-collapse collapse" aria-labelledby="headingEID" data-bs-parent="#accordionEID">
                        <div class="accordion-body">
                                                         <div class="row">
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">EID Status</label>
                     <select name="eid" id="add_eid" class="form-control">
                         <option value="">Select</option>
                         {% for eid_status in eid_status_data %}
                         <option value="{{ eid_status.base_value }}">{{ eid_status.base_description }}</option>
                         {% endfor %}
                     </select>
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">EID Date</label>
                                     <input type="date" name="eid_date" id="add_eid_date" class="form-control">
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">Remarks</label>
                                     <input type="text" name="eid_remarks" id="add_eid_remarks" class="form-control">
                                 </div>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RP Stamping Accordion -->
            <div class="accordion mb-3" id="accordionRPStamping">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingRPStamping">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRPStamping" aria-expanded="false" aria-controls="collapseRPStamping">
                            <i class="ti ti-stamp me-2"></i> RP Stamping
                        </button>
                    </h2>
                    <div id="collapseRPStamping" class="accordion-collapse collapse" aria-labelledby="headingRPStamping" data-bs-parent="#accordionRPStamping">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">RP Stamping Status</label>
                    <select name="rp_stamping" id="add_rp_stamping" class="form-control">
                        <option value="">Select</option>
                        {% for rp_stamping in rp_stamping_data %}
                        <option value="{{ rp_stamping.base_value }}">{{ rp_stamping.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">RP Stamping Date</label>
                                    <input type="date" name="rp_stamping_date" id="add_rp_stamping_date" class="form-control">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documents Accordion -->
            <div class="accordion mb-3" id="accordionDocuments">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingDocuments">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDocuments" aria-expanded="false" aria-controls="collapseDocuments">
                            <i class="ti ti-files me-2"></i> Documents
                        </button>
                    </h2>
                    <div id="collapseDocuments" class="accordion-collapse collapse" aria-labelledby="headingDocuments" data-bs-parent="#accordionDocuments">
                        <div class="accordion-body">
                            <small class="form-text text-muted mb-3">Maximum file size: 5MB for all document uploads</small>
                            <table class="table" id="documentUploadTable_add">
                                <thead>
                                    <tr>
                                        <th>Document Name</th>
                                        <th>File Upload</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <input type="hidden" name="document_id[]" value="">
                                            <input type="text" name="document_name[]" class="form-control">
                                        </td>
                                        <td>
                                            <input type="file" name="document_file[]" class="form-control" accept="application/pdf,image/*">
                                            <div class="file-preview"></div>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger" onclick="removeDocumentRow_add(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            <button type="button" class="btn btn-primary" onclick="addDocumentRow_add()">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-light me-2" data-bs-dismiss="offcanvas">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<script>
$(function() {
    $('#add_emp_code').change(function() {
        var emp_code = $(this).val();
        if (emp_code) {
            $.ajax({
                url: "{% url 'get_employee_details_by_code' %}",
                type: "GET",
                data: { emp_code: emp_code },
                success: function(response) {
                    if (response.success) {
                        var d = response.data;
                        $('#add_pp_number').val(d.pp_number || '');
                        $('#add_name').val(d.name || '');
                        $('#add_in_outside').val(d.in_outside || '');
                        $('#add_status').val(d.status || '');
                        $('#add_sub_status').val(d.sub_status || '');
                        $('#add_work_location').val(d.work_location || '');
                        $('#add_doj').val(d.doj || '');
                        $('#add_gender').val(d.gender || '');
                        $('#add_designation').val(d.designation || '');
                        $('#add_nationality').val(d.nationality || '');
                    } else {
                        // Optionally clear fields if not found
                    }
                }
            });
        }
    });
});
</script>

<!-- Edit Employee Passport Details Offcanvas -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas_edit" style="width: 1000px !important;">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title" id="offcanvas_edit_employee_pp_label">Edit Employee PLVP Details</h5>
        <button type="button" class="btn-close custom-btn-close border p-1 me-0 d-flex align-items-center justify-content-center rounded-circle" data-bs-dismiss="offcanvas" aria-label="Close">
            <i class="ti ti-x"></i>
        </button>
    </div>
    <div class="offcanvas-body">
        <form id="editEmployeePPForm" action="{% url 'employee_pp_update' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="id" id="edit_id">
            
            <!-- Basic Information Section -->
            <div class="mb-4">
                <h6 class="mb-3"><i class="ti ti-user me-2"></i> Basic Information</h6>
            <div class="row">
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Employee Code</label>
                    <select name="emp_code" id="edit_emp_code" class="form-control select2">
                        <option value="">Select Employee Code</option>
                        {% for employee in employee_data %}
                        <option value="{{ employee.emp_code }}">{{ employee.emp_code }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Passport Number</label>
                    <input type="text" name="pp_number" id="edit_pp_number" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Name</label>
                    <input type="text" name="name" id="edit_name" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">In/Outside</label>
                    <select name="in_outside" id="edit_in_outside" class="form-control">
                        <option value="">Select</option>
                        <option value="inside">Inside</option>
                        <option value="outside">Outside</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Status</label>
                    <select name="status" id="edit_status" class="form-control">
                        <option value="">Select</option>
                        {% for status in status_data %}
                        <option value="{{ status.base_value }}">{{ status.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Sub Status</label>
                    <input type="text" name="sub_status" id="edit_sub_status" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Work Location</label>
                    <input type="text" name="work_location" id="edit_work_location" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Date of Joining</label>
                    <input type="date" name="doj" id="edit_doj" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Gender</label>
                    <select name="gender" id="edit_gender" class="form-control">
                        <option value="">Select</option>
                        {% for gender in gender_data %}
                        <option value="{{ gender.base_value }}">{{ gender.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Designation</label>
                    <select name="designation" id="edit_designation" class="form-control">
                        <option value="">Select</option>
                        {% for designation in desig_data %}
                        <option value="{{ designation.base_value }}">{{ designation.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Nationality</label>
                    <select name="nationality" id="edit_nationality" class="form-control">
                        <option value="">Select</option>
                        {% for nationality in nation_data %}
                        <option value="{{ nationality.base_value }}">{{ nationality.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">PP Control</label>
                    <select name="pp_control" id="edit_pp_control" class="form-control">
                        <option value="">Select</option>
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Date of Landing</label>
                    <input type="date" name="date_of_landing" id="edit_date_of_landing" class="form-control">
                </div>
                <div class="col-md-4 mb-3">
                    <label class="col-form-label">No of Days</label>
                    <input type="number" name="no_of_days" id="edit_no_of_days" class="form-control" readonly>
                </div>
                                <div class="col-md-4 mb-3">
                    <label class="col-form-label">Fine Amount</label>
                    <input type="number" step="0.01" name="fine_amount" id="edit_fine_amount" class="form-control">
                </div>
                            </div>
            </div>

            <!-- Tawjeeh Accordion -->
            <div class="accordion mb-3" id="accordionEditTawjeeh">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditTawjeeh">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditTawjeeh" aria-expanded="false" aria-controls="collapseEditTawjeeh">
                            <i class="ti ti-book me-2"></i> Tawjeeh
                        </button>
                    </h2>
                    <div id="collapseEditTawjeeh" class="accordion-collapse collapse" aria-labelledby="headingEditTawjeeh" data-bs-parent="#accordionEditTawjeeh">
                        <div class="accordion-body">
                                                         <!-- Form Fields -->
                             <div class="row mb-4">
                                 <div class="col-md-6 mb-3">
                     <label class="col-form-label">Tawjeeh Type</label>
                     <select name="tawjeeh_class" id="edit_tawjeeh_class" class="form-control">
                         <option value="">Select</option>
                         {% for tawjeeh_class_status in tawjeeh_class_status_data %}
                         <option value="{{ tawjeeh_class_status.base_value }}">{{ tawjeeh_class_status.base_description }}</option>
                         {% endfor %}
                     </select>
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">Tawjeeh Date</label>
                                     <input type="date" name="tawjeeh_date" id="edit_tawjeeh_date" class="form-control">
                                 </div>
                             </div>
                             
                             <!-- Display Data -->
                             <div class="table-responsive">
                                 <table class="table table-bordered table-hover">
                                     <thead class="table-light">
                                         <tr>
                                             <th>Tawjeeh Type</th>
                                             <th>Tawjeeh Date</th>
                                         </tr>
                                     </thead>
                                     <tbody id="tawjeeh_data_body">
                                         <tr id="tawjeeh_data_row" style="display: none;">
                                             <td id="tawjeeh_class_display"></td>
                                             <td id="tawjeeh_date_display"></td>
                                         </tr>
                                     </tbody>
                                 </table>
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ILOE Accordion -->
            <div class="accordion mb-3" id="accordionEditILOE">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditILOE">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditILOE" aria-expanded="false" aria-controls="collapseEditILOE">
                            <i class="ti ti-file-check me-2"></i> ILOE Status
                        </button>
                    </h2>
                    <div id="collapseEditILOE" class="accordion-collapse collapse" aria-labelledby="headingEditILOE" data-bs-parent="#accordionEditILOE">
                        <div class="accordion-body">
                            <!-- Form Fields -->
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                    <label class="col-form-label">ILOE Status</label>
                    <select name="iloe_status" id="edit_iloe_status" class="form-control">
                        <option value="">Select</option>
                        {% for ioe_status in ioe_status_data %}
                        <option value="{{ ioe_status.base_value }}">{{ ioe_status.base_description }}</option>
                        {% endfor %}
                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Number</label>
                                    <input type="text" name="iloe_number" id="edit_iloe_number" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Inception Date</label>
                                    <input type="date" name="iloe_inception_date" id="edit_iloe_inception_date" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Expiry Date</label>
                                    <input type="date" name="iloe_expiry_date" id="edit_iloe_expiry_date" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">ILOE Date</label>
                                    <input type="date" name="iloe_date" id="edit_iloe_date" class="form-control">
                                </div>
                            </div>
                            
                            <!-- Display Data -->
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ILOE Status</th>
                                            <th>ILOE Number</th>
                                            <th>ILOE Inception Date</th>
                                            <th>ILOE Expiry Date</th>
                                            <th>ILOE Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="iloe_data_body">
                                        <tr id="iloe_data_row" style="display: none;">
                                            <td id="iloe_status_display"></td>
                                            <td id="iloe_number_display"></td>
                                            <td id="iloe_inception_date_display"></td>
                                            <td id="iloe_expiry_date_display"></td>
                                            <td id="iloe_date_display"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Accordion -->
            <div class="accordion mb-3" id="accordionEditMedical">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditMedical">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditMedical" aria-expanded="false" aria-controls="collapseEditMedical">
                            <i class="ti ti-stethoscope me-2"></i> Medical
                        </button>
                    </h2>
                    <div id="collapseEditMedical" class="accordion-collapse collapse" aria-labelledby="headingEditMedical" data-bs-parent="#accordionEditMedical">
                        <div class="accordion-body">
                            <!-- Form Fields -->
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Medical Status</label>
                    <select name="medical" id="edit_medical" class="form-control">
                        <option value="">Select</option>
                        {% for medical_status in medical_status_data %}
                        <option value="{{ medical_status.base_value }}">{{ medical_status.base_value }} - {{ medical_status.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                                <div class="col-md-6 mb-3">
                    <label class="col-form-label">Medical Result Date</label>
                    <input type="date" name="medical_result_date" id="edit_medical_result_date" class="form-control">
                </div>
                                <div class="col-md-6 mb-3">
                    <label class="col-form-label">Remedical Result Date</label>
                    <input type="date" name="remedical_result_date" id="edit_remedical_result_date" class="form-control">
                                </div>
                            </div>
                            
                            <!-- Display Data -->
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Medical Status</th>
                                            <th>Medical Result Date</th>
                                            <th>Remedical Result Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="medical_data_body">
                                        <tr id="medical_data_row" style="display: none;">
                                            <td id="medical_status_display"></td>
                                            <td id="medical_result_date_display"></td>
                                            <td id="remedical_result_date_display"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health Insurance Accordion -->
            <div class="accordion mb-3" id="accordionEditHealthInsurance">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditHealthInsurance">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditHealthInsurance" aria-expanded="false" aria-controls="collapseEditHealthInsurance">
                            <i class="ti ti-shield-check me-2"></i> Health Insurance
                        </button>
                    </h2>
                    <div id="collapseEditHealthInsurance" class="accordion-collapse collapse" aria-labelledby="headingEditHealthInsurance" data-bs-parent="#accordionEditHealthInsurance">
                        <div class="accordion-body">
                            <!-- Form Fields -->
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Insurance Status</label>
                                    <select name="insurance_status" id="edit_insurance_status" class="form-control">
                                        <option value="">Select</option>
                                        <option value="Active">Active</option>
                                        <option value="Inactive">Inactive</option>
                                        <option value="Pending">Pending</option>
                                        <option value="Expired">Expired</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Card Number</label>
                                    <input type="text" name="insurance_card_number" id="edit_insurance_card_number" class="form-control">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">Expiry Date</label>
                                    <input type="date" name="insurance_expiry_date" id="edit_insurance_expiry_date" class="form-control">
                                </div>
                            </div>
                            
                            <!-- Display Data -->
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Insurance Status</th>
                                            <th>Card Number</th>
                                            <th>Expiry Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="health_insurance_data_body">
                                        <tr id="health_insurance_data_row" style="display: none;">
                                            <td id="insurance_status_display"></td>
                                            <td id="insurance_card_number_display"></td>
                                            <td id="insurance_expiry_date_display"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EID Accordion -->
            <div class="accordion mb-3" id="accordionEditEID">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditEID">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditEID" aria-expanded="false" aria-controls="collapseEditEID">
                            <i class="ti ti-id me-2"></i> EID
                        </button>
                    </h2>
                    <div id="collapseEditEID" class="accordion-collapse collapse" aria-labelledby="headingEditEID" data-bs-parent="#accordionEditEID">
                        <div class="accordion-body">
                                                         <!-- Form Fields -->
                             <div class="row mb-4">
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">EID Status</label>
                     <select name="eid" id="edit_eid" class="form-control">
                         <option value="">Select</option>
                         {% for eid_status in eid_status_data %}
                         <option value="{{ eid_status.base_value }}">{{ eid_status.base_description }}</option>
                         {% endfor %}
                     </select>
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">EID Date</label>
                                     <input type="date" name="eid_date" id="edit_eid_date" class="form-control">
                                 </div>
                                 <div class="col-md-6 mb-3">
                                     <label class="col-form-label">Remarks</label>
                                     <input type="text" name="eid_remarks" id="edit_eid_remarks" class="form-control">
                                 </div>
                             </div>
                            
                            <!-- Display Data -->
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                                                         <thead class="table-light">
                                         <tr>
                                             <th>EID Status</th>
                                             <th>EID Date</th>
                                             <th>Remarks</th>
                                         </tr>
                                     </thead>
                                     <tbody id="eid_data_body">
                                         <tr id="eid_data_row" style="display: none;">
                                             <td id="eid_status_display"></td>
                                             <td id="eid_date_display"></td>
                                             <td id="eid_remarks_display"></td>
                                         </tr>
                                     </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RP Stamping Accordion -->
            <div class="accordion mb-3" id="accordionEditRPStamping">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditRPStamping">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditRPStamping" aria-expanded="false" aria-controls="collapseEditRPStamping">
                            <i class="ti ti-stamp me-2"></i> RP Stamping
                        </button>
                    </h2>
                    <div id="collapseEditRPStamping" class="accordion-collapse collapse" aria-labelledby="headingEditRPStamping" data-bs-parent="#accordionEditRPStamping">
                        <div class="accordion-body">
                            <!-- Form Fields -->
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">RP Stamping Status</label>
                    <select name="rp_stamping" id="edit_rp_stamping" class="form-control">
                        <option value="">Select</option>
                        {% for rp_stamping in rp_stamping_data %}
                        <option value="{{ rp_stamping.base_value }}">{{ rp_stamping.base_description }}</option>
                        {% endfor %}
                    </select>
                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="col-form-label">RP Stamping Date</label>
                                    <input type="date" name="rp_stamping_date" id="edit_rp_stamping_date" class="form-control">
                                </div>
                            </div>
                            
                            <!-- Display Data -->
                            <div class="table-responsive">
                                <table class="table table-bordered table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>RP Stamping Status</th>
                                            <th>RP Stamping Date</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rp_stamping_data_body">
                                        <tr id="rp_stamping_data_row" style="display: none;">
                                            <td id="rp_stamping_status_display"></td>
                                            <td id="rp_stamping_date_display"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documents Accordion -->
            <div class="accordion mb-3" id="accordionEditDocuments">
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingEditDocuments">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEditDocuments" aria-expanded="false" aria-controls="collapseEditDocuments">
                            <i class="ti ti-files me-2"></i> Documents
                        </button>
                    </h2>
                    <div id="collapseEditDocuments" class="accordion-collapse collapse" aria-labelledby="headingEditDocuments" data-bs-parent="#accordionEditDocuments">
                        <div class="accordion-body">
                            <small class="form-text text-muted mb-3">Maximum file size: 5MB for all document uploads</small>
                            <input type="hidden" name="documents_to_remove" id="documents_to_remove">
                            <table class="table" id="documentUploadTable_edit">
                                <thead>
                                    <tr>
                                        <th>Document Name</th>
                                        <th>File Upload</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <input type="hidden" name="document_id[]" value="">
                                            <input type="text" name="document_name[]" class="form-control">
                                        </td>
                                        <td>
                                            <input type="file" name="document_file[]" class="form-control" accept="application/pdf,image/*">
                                            <div class="file-preview"></div>
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-danger" onclick="removeDocumentRow_edit(this)">
                                                <i class="fas fa-times"></i>
                                            </button>
                                            <button type="button" class="btn btn-primary" onclick="addDocumentRow_edit()">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end">
                <button type="button" class="btn btn-light me-2" data-bs-dismiss="offcanvas">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
        </form>
    </div>
</div> 

<script>
    // Document handling functions for multi-entry table
    function addDocumentRow_add() {
        const tableBody = document.querySelector('#documentUploadTable_add tbody');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>
                <input type="hidden" name="document_id[]" value="">
                <input type="text" name="document_name[]" class="form-control">
            </td>
            <td>
                <input type="file" name="document_file[]" class="form-control" accept="application/pdf,image/*">
                <div class="file-preview"></div>
            </td>
            <td>
                <button type="button" class="btn btn-danger" onclick="removeDocumentRow_add(this)">
                    <i class="fas fa-times"></i>
                </button>
                <button type="button" class="btn btn-primary" onclick="addDocumentRow_add()">
                    <i class="fas fa-plus"></i>
                </button>
            </td>
        `;
        tableBody.appendChild(newRow);
    }

    function removeDocumentRow_add(button, documentId = null) {
        const row = button.closest('tr');
        const tableBody = document.querySelector('#documentUploadTable_add tbody');
        
        if (!tableBody) {
            console.error('Table body not found');
            return;
        }
        
        // If this is an existing document (has documentId), add it to documents_to_remove
        if (documentId) {
            let documentsToRemove = document.getElementById('documents_to_remove');
            
            if (!documentsToRemove) {
                documentsToRemove = document.createElement('input');
                documentsToRemove.type = 'hidden';
                documentsToRemove.id = 'documents_to_remove';
                documentsToRemove.name = 'documents_to_remove';
                const table = document.getElementById('documentUploadTable_add');
                if (table && table.parentNode) {
                    table.parentNode.appendChild(documentsToRemove);
                }
            }
            
            // Get current values and add new documentId
            const currentValues = documentsToRemove.value ? documentsToRemove.value.split(',') : [];
            if (!currentValues.includes(documentId.toString())) {
                currentValues.push(documentId.toString());
                documentsToRemove.value = currentValues.join(',');
            }
        }
        
        // Ensure at least one row remains
        if (tableBody.rows.length > 1) {
            row.remove();
        } else {
            // Show warning message
            const message = document.createElement('div');
            message.className = 'alert alert-warning mt-3';
            message.innerText = "At least one row must remain.";
            
            // Insert after table
            const table = document.getElementById('documentUploadTable_add');
            if (table && table.parentNode) {
                table.parentNode.insertBefore(message, table.nextSibling);
                
                // Remove after 3 seconds
                setTimeout(() => message.remove(), 3000);
            }
        }
    }

    function addDocumentRow_edit() {
        const tableBody = document.querySelector('#documentUploadTable_edit tbody');
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>
                <input type="hidden" name="document_id[]" value="">
                <input type="text" name="document_name[]" class="form-control">
            </td>
            <td>
                <input type="file" name="document_file[]" class="form-control" accept="application/pdf,image/*">
                <div class="file-preview"></div>
            </td>
            <td>
                <button type="button" class="btn btn-danger" onclick="removeDocumentRow_edit(this)">
                    <i class="fas fa-times"></i>
                </button>
                <button type="button" class="btn btn-primary" onclick="addDocumentRow_edit()">
                    <i class="fas fa-plus"></i>
                </button>
            </td>
        `;
        tableBody.appendChild(newRow);
    }

    function removeDocumentRow_edit(button, documentId = null) {
        const row = button.closest('tr');
        const tableBody = document.querySelector('#documentUploadTable_edit tbody');
        
        if (!tableBody) {
            console.error('Table body not found');
            return;
        }
        
        // If this is an existing document (has documentId), add it to documents_to_remove
        if (documentId) {
            let documentsToRemove = document.getElementById('documents_to_remove');
            
            if (!documentsToRemove) {
                documentsToRemove = document.createElement('input');
                documentsToRemove.type = 'hidden';
                documentsToRemove.id = 'documents_to_remove';
                documentsToRemove.name = 'documents_to_remove';
                const table = document.getElementById('documentUploadTable_edit');
                if (table && table.parentNode) {
                    table.parentNode.appendChild(documentsToRemove);
                }
            }
            
            // Get current values and add new documentId
            const currentValues = documentsToRemove.value ? documentsToRemove.value.split(',') : [];
            if (!currentValues.includes(documentId.toString())) {
                currentValues.push(documentId.toString());
                documentsToRemove.value = currentValues.join(',');
            }
        }
        
        // Ensure at least one row remains
        if (tableBody.rows.length > 1) {
            row.remove();
        } else {
            // Show warning message
            const message = document.createElement('div');
            message.className = 'alert alert-warning mt-3';
            message.innerText = "At least one row must remain.";
            
            // Insert after table
            const table = document.getElementById('documentUploadTable_edit');
            if (table && table.parentNode) {
                table.parentNode.insertBefore(message, table.nextSibling);
                
                // Remove after 3 seconds
                setTimeout(() => message.remove(), 3000);
            }
        }
    }
</script> 
